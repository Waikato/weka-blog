<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Making a Weka classifier | WEKA Blog</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://waikato.github.io/weka-blog/posts/2018-10-08-making-a-weka-classifier/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="eibe">
<link rel="prev" href="../2018-09-04-383-and-393-released/" title="Weka 3.8.3 and 3.9.3 released" type="text/html">
<meta property="og:site_name" content="WEKA Blog">
<meta property="og:title" content="Making a Weka classifier">
<meta property="og:url" content="https://waikato.github.io/weka-blog/posts/2018-10-08-making-a-weka-classifier/">
<meta property="og:description" content="One role of the Weka software is to provide users with the opportunity to implement machine learning algorithms without having to deal with data import and evaluation issues: when a classifier has bee">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2018-10-08T16:02:00+12:00">
<meta property="article:tag" content="github">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://waikato.github.io/weka-blog/">

                <span id="blog-title">WEKA Blog</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" role="navigation" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>
                </li>
<li>
<a href="../../rss.xml">RSS feed</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li>
    <a href="index.rst" id="sourcelink">Source</a>
    </li>

                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Making a Weka classifier</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                    <a href="../../authors/eibe/">eibe</a>
            </span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2018-10-08T16:02:00+12:00" itemprop="datePublished" title="2018-10-08 16:02">2018-10-08 16:02</time></a></p>
                <p class="commentline">
        
    <a href="#disqus_thread" data-disqus-identifier="cache/posts/2018-10-08-making-a-weka-classifier.html">Comments</a>


            
        </p>
<p class="sourceline"><a href="index.rst" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>One role of the Weka software is to provide users with the opportunity to implement machine learning algorithms without having to deal with data import and evaluation issues: when a classifier has been written as a Java class that implements a couple of standard methods defined in the Weka framework, all the goodies that come with Weka are automatically applicable to it, and it will automatically show up in Weka's graphical user interfaces. To see what needs to be done, read on!</p>
<!-- TEASER_END -->
<p>To integrate your supervised learning algorithm into Weka, you need to make a Java class that implements Weka’s <tt class="docutils literal">Classifier</tt> interface. Note that regression methods are also implemented as <tt class="docutils literal">Classifier</tt> objects in Weka: the historic reason for this is that regression has sometimes been termed classification with “continuous classes” in early work on machine learning.</p>
<p>There are three primary methods in this <tt class="docutils literal">Classifier</tt> interface: <tt class="docutils literal">buildClassifier(Instances)</tt>, which will build the classification or regression model based on the given training instances, <tt class="docutils literal">classifyInstance(Instance)</tt>, which takes a test instance and returns a single predicted class value for the instance that is supplied, and <tt class="docutils literal">distributionForInstance(Instance)</tt>, which returns a class probability distribution instead, assuming the class attribute is nominal. The fourth method in the <tt class="docutils literal">Classifier</tt> interface, <tt class="docutils literal">getCapabilities()</tt>, returns the capabilities of the classifier, specifying what kind of data it can be applied to.</p>
<p>In practice, it is normally best to just extend Weka’s <tt class="docutils literal">AbstractClassifier</tt> class, which implements the <tt class="docutils literal">Classifier</tt> interface and is the superclass of pretty much all <tt class="docutils literal">Classifier</tt> classes in Weka. It has default implementations for the <tt class="docutils literal">distributionForInstance(Instance)</tt> and <tt class="docutils literal">classifyInstance(Instance)</tt> methods specified in the <tt class="docutils literal">Classifier</tt> interface. In your <tt class="docutils literal">Classifier</tt> class, you <em>must</em> override at least one of these methods. You also need to implement the <tt class="docutils literal">buildClassifier(Instances)</tt> method to actually build the classification/regression model. The <tt class="docutils literal">AbstractClassifier</tt> also has a default implementation of the <tt class="docutils literal">getCapabilities()</tt> method, which simply returns all possible capabilities, implying that the classifier can be applied to any kind of training data. Hence, implementation of this method is optional if you extend <tt class="docutils literal">AbstractClassifier</tt>.</p>
<p>So, at a minimum, the Java class for your learning algorithm, assuming it extends <tt class="docutils literal">AbstractClassifier</tt>, needs to implement two methods: <tt class="docutils literal">buildClassifier(Instances)</tt> and <tt class="docutils literal">distributionForInstance(Instance)</tt> (or <tt class="docutils literal">classifyInstance(Instance)</tt>). The <tt class="docutils literal">distributionForInstance(Instance)</tt> method must return a double array containing the estimated class probabilities for the different class values of the test instance if the class is nominal. If the class is numeric, it must return a single-element array with the numeric prediction for the test instance. The <tt class="docutils literal">classifyInstance(Instance)</tt> method, if you choose to implement it instead of <tt class="docutils literal">distributionForInstance(Instance)</tt>, must return the index of the predicted class value (coded as a number of type <tt class="docutils literal">double</tt>) if the class is nominal and simply return the predicted class value if the class is numeric.</p>
<p>For Weka to find your class using its automatic Java class discovery mechanism when you actually want to run your Classifier through Weka’s graphical user interfaces (GUIs), your class needs to be in the Java <tt class="docutils literal">CLASSPATH</tt> and in one of the standard classifier Java packages (e.g., weka.classifiers.functions or weka.classifiers.trees). If that is the case, regardless of where your class is physically located on your file system, it will show up in Weka’s GUIs automatically (for example, if you invoke the <tt class="docutils literal">main()</tt> method of weka.gui.GUIChooser, which is the main entry point into Weka’s GUIs).</p>
<p>Note that the standard Java package structuring rules apply: the directory structure for your class needs to match up with the fully qualified Java class name, e.g., <tt class="docutils literal">weka.classifiers.functions.MyFunctionalClassifier</tt> must be located in a folder called <tt class="docutils literal">functions</tt>, which in turn is located inside a folder called <tt class="docutils literal">classifiers</tt>, which in turn is located in a folder called <tt class="docutils literal">weka</tt>. The folder containing this <tt class="docutils literal">weka</tt> folder will need to be included in your <tt class="docutils literal">CLASSPATH</tt>.</p>
<p>Note also that, for Weka’s GUIs to work properly with your class, it needs to implement Java's <tt class="docutils literal">Serializable</tt> indicator interface. <tt class="docutils literal">AbstractClassifier</tt> does that and also implements a bunch of other interfaces, including the OptionHandler interface that is used for command-line option handling.</p>
<p>There are four command-line options already implemented in <tt class="docutils literal">AbstractClassifier</tt>:</p>
<pre class="literal-block">
-output-debug-info
-do-not-check-capabiliities
-num-decimal-places
-batch-size
</pre>
<p>The first option will simply set the protected member variable <tt class="docutils literal">m_Debug</tt> to true. You can use it in your class to output optional debug information, or you can just ignore it. The second option is only relevant if your class implements handling of capabilities. More on that in a second. The third option sets the value of the <tt class="docutils literal">m_numDecimalPlaces</tt> variable. This should be used in the <tt class="docutils literal">toString()</tt> method of your class, which you need to implement if you want a textual description of your model to be output by Weka, to specify the number of significant digits that are used when numbers are included in the output. The fourth option is ignored by almost all classifiers in Weka: it can be used to set a desired batch size for batch prediction when the classifier is used in batch prediction mode.</p>
<p>Below, I have included an implementation of a basic K-nearest-neighbours classifier for Weka. It implements <tt class="docutils literal">buildClassifier(Instances)</tt> and <tt class="docutils literal">distributionForInstance(Instance)</tt>, the two required methods for a <tt class="docutils literal">Classifier</tt>, but also illustrates option handling for setting the parameter <tt class="docutils literal">K</tt>: the <tt class="docutils literal">setK(int)</tt> and <tt class="docutils literal">getK()</tt> methods are used for setting <tt class="docutils literal">K</tt> in Weka’s GUIs. Whenever a matching getter and setter method pair is found in a <tt class="docutils literal">Classifier</tt> object, it will automatically show up in the <tt class="docutils literal">GenericObjectEditor</tt> that is used to configure learning schemes in Weka’s GUIs. Looking at the code a bit further, the information in the <tt class="docutils literal"><span class="pre">@OptionMetaData(…)</span></tt> tag is used to specify the corresponding command-line option for the setter/getter pair. The <tt class="docutils literal">toString()</tt> method in this example code is rudimentary and just outputs the number of neighbours used by the classifier.</p>
<pre class="code Java"><a name="rest_code_d588aec12977499a8e18857c3955c2ab-1"></a><span class="cm">/**</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-2"></a><span class="cm">* This code is released to the public domain. Use as you see fit.</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-3"></a><span class="cm">*/</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-4"></a><span class="kn">package</span> <span class="nn">weka.classifiers.lazy</span><span class="o">;</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-5"></a>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-6"></a><span class="kn">import</span> <span class="nn">weka.core.Instance</span><span class="o">;</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-7"></a><span class="kn">import</span> <span class="nn">weka.core.Instances</span><span class="o">;</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-8"></a><span class="kn">import</span> <span class="nn">weka.classifiers.AbstractClassifier</span><span class="o">;</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-9"></a><span class="kn">import</span> <span class="nn">weka.core.neighboursearch.LinearNNSearch</span><span class="o">;</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-10"></a><span class="kn">import</span> <span class="nn">weka.core.neighboursearch.NearestNeighbourSearch</span><span class="o">;</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-11"></a><span class="kn">import</span> <span class="nn">weka.core.OptionMetadata</span><span class="o">;</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-12"></a><span class="kn">import</span> <span class="nn">weka.core.Capabilities</span><span class="o">;</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-13"></a>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-14"></a><span class="cm">/**</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-15"></a><span class="cm">* Implements the k-nearest-neighbours method for classification and</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-16"></a><span class="cm">* regression.  Existing WEKA code is used to retrieve the K nearest</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-17"></a><span class="cm">* neighbours for a test instance. The number of neighbours to use is</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-18"></a><span class="cm">* a parameter that the user can specify, via a get...()/set...()</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-19"></a><span class="cm">* method pair for WEKA's GUIs and a Java annotation for command-line</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-20"></a><span class="cm">* option handling.</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-21"></a><span class="cm">*/</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-22"></a><span class="kd">public</span> <span class="kd">class</span> <span class="nc">KNN</span> <span class="kd">extends</span> <span class="n">AbstractClassifier</span> <span class="o">{</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-23"></a>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-24"></a>   <span class="cm">/** The number of neighbours to use */</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-25"></a>   <span class="kd">protected</span> <span class="kt">int</span> <span class="n">m_K</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-26"></a>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-27"></a>   <span class="cm">/** The method to be used to search for nearest neighbours. */</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-28"></a>   <span class="kd">protected</span> <span class="n">NearestNeighbourSearch</span> <span class="n">m_NNSearch</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinearNNSearch</span><span class="o">();</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-29"></a>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-30"></a>   <span class="cm">/**</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-31"></a><span class="cm">    * Returns capabilities of the classifier.</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-32"></a><span class="cm">    *</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-33"></a><span class="cm">    * @return the capabilities of this classifier</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-34"></a><span class="cm">    */</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-35"></a>   <span class="kd">public</span> <span class="n">Capabilities</span> <span class="nf">getCapabilities</span><span class="o">()</span> <span class="o">{</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-36"></a>       <span class="n">Capabilities</span> <span class="n">result</span> <span class="o">=</span> <span class="kd">super</span><span class="o">.</span><span class="na">getCapabilities</span><span class="o">();</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-37"></a>       <span class="n">result</span><span class="o">.</span><span class="na">disableAll</span><span class="o">();</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-38"></a>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-39"></a>       <span class="c1">// predictor attributes</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-40"></a>       <span class="n">result</span><span class="o">.</span><span class="na">enable</span><span class="o">(</span><span class="n">Capabilities</span><span class="o">.</span><span class="na">Capability</span><span class="o">.</span><span class="na">NOMINAL_ATTRIBUTES</span><span class="o">);</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-41"></a>       <span class="n">result</span><span class="o">.</span><span class="na">enable</span><span class="o">(</span><span class="n">Capabilities</span><span class="o">.</span><span class="na">Capability</span><span class="o">.</span><span class="na">NUMERIC_ATTRIBUTES</span><span class="o">);</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-42"></a>       <span class="n">result</span><span class="o">.</span><span class="na">enable</span><span class="o">(</span><span class="n">Capabilities</span><span class="o">.</span><span class="na">Capability</span><span class="o">.</span><span class="na">DATE_ATTRIBUTES</span><span class="o">);</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-43"></a>       <span class="n">result</span><span class="o">.</span><span class="na">enable</span><span class="o">(</span><span class="n">Capabilities</span><span class="o">.</span><span class="na">Capability</span><span class="o">.</span><span class="na">MISSING_VALUES</span><span class="o">);</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-44"></a>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-45"></a>       <span class="c1">// class</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-46"></a>       <span class="n">result</span><span class="o">.</span><span class="na">enable</span><span class="o">(</span><span class="n">Capabilities</span><span class="o">.</span><span class="na">Capability</span><span class="o">.</span><span class="na">NOMINAL_CLASS</span><span class="o">);</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-47"></a>       <span class="n">result</span><span class="o">.</span><span class="na">enable</span><span class="o">(</span><span class="n">Capabilities</span><span class="o">.</span><span class="na">Capability</span><span class="o">.</span><span class="na">NUMERIC_CLASS</span><span class="o">);</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-48"></a>       <span class="n">result</span><span class="o">.</span><span class="na">enable</span><span class="o">(</span><span class="n">Capabilities</span><span class="o">.</span><span class="na">Capability</span><span class="o">.</span><span class="na">DATE_CLASS</span><span class="o">);</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-49"></a>       <span class="n">result</span><span class="o">.</span><span class="na">enable</span><span class="o">(</span><span class="n">Capabilities</span><span class="o">.</span><span class="na">Capability</span><span class="o">.</span><span class="na">MISSING_CLASS_VALUES</span><span class="o">);</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-50"></a>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-51"></a>       <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-52"></a>   <span class="o">}</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-53"></a>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-54"></a>   <span class="cm">/**</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-55"></a><span class="cm">    * Method to set the number of neighbours. Including metadata annotation</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-56"></a><span class="cm">    * to implement command-line option handling for this parameter.</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-57"></a><span class="cm">    */</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-58"></a>   <span class="nd">@OptionMetadata</span><span class="o">(</span><span class="n">displayName</span> <span class="o">=</span> <span class="s">"number of neighbours"</span><span class="o">,</span> <span class="n">description</span> <span class="o">=</span> <span class="s">"Number of neighbours to use (default = 1)."</span><span class="o">,</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-59"></a>                   <span class="n">commandLineParamName</span> <span class="o">=</span> <span class="s">"K"</span><span class="o">,</span> <span class="n">commandLineParamSynopsis</span> <span class="o">=</span> <span class="s">"-K &lt;int&gt;"</span><span class="o">,</span> <span class="n">displayOrder</span> <span class="o">=</span> <span class="mi">1</span><span class="o">)</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-60"></a>   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setK</span><span class="o">(</span><span class="kt">int</span> <span class="n">k</span><span class="o">)</span> <span class="o">{</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-61"></a>       <span class="n">m_K</span> <span class="o">=</span> <span class="n">k</span><span class="o">;</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-62"></a>   <span class="o">}</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-63"></a>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-64"></a>   <span class="cm">/**</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-65"></a><span class="cm">    * Method to get the currently set number of neighbours.</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-66"></a><span class="cm">    */</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-67"></a>   <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getK</span><span class="o">()</span> <span class="o">{</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-68"></a>       <span class="k">return</span> <span class="n">m_K</span><span class="o">;</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-69"></a>   <span class="o">}</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-70"></a>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-71"></a>   <span class="cm">/**</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-72"></a><span class="cm">    * Initialises the classifier from the given training instances.</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-73"></a><span class="cm">    */</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-74"></a>   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">buildClassifier</span><span class="o">(</span><span class="n">Instances</span> <span class="n">trainingData</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-75"></a>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-76"></a>       <span class="c1">// Can the classifier handle the data?</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-77"></a>       <span class="n">getCapabilities</span><span class="o">().</span><span class="na">testWithFail</span><span class="o">(</span><span class="n">trainingData</span><span class="o">);</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-78"></a>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-79"></a>       <span class="c1">// Make a copy of data and delete instances with a missing class value</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-80"></a>       <span class="n">trainingData</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Instances</span><span class="o">(</span><span class="n">trainingData</span><span class="o">);</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-81"></a>       <span class="n">trainingData</span><span class="o">.</span><span class="na">deleteWithMissingClass</span><span class="o">();</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-82"></a>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-83"></a>       <span class="c1">// Trivial for KNN: just initialise NN search class</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-84"></a>       <span class="n">m_NNSearch</span><span class="o">.</span><span class="na">setInstances</span><span class="o">(</span><span class="n">trainingData</span><span class="o">);</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-85"></a>   <span class="o">}</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-86"></a>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-87"></a>   <span class="cm">/**</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-88"></a><span class="cm">    * Returns class probability distribution (classification) or numeric</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-89"></a><span class="cm">    * target value (regression) for a given test instance.</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-90"></a><span class="cm">    */</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-91"></a>   <span class="kd">public</span> <span class="kt">double</span><span class="o">[]</span> <span class="nf">distributionForInstance</span><span class="o">(</span><span class="n">Instance</span> <span class="n">testInstance</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-92"></a>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-93"></a>       <span class="c1">// Add instance to NN search so that attribute ranges can be updated</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-94"></a>       <span class="n">m_NNSearch</span><span class="o">.</span><span class="na">addInstanceInfo</span><span class="o">(</span><span class="n">testInstance</span><span class="o">);</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-95"></a>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-96"></a>       <span class="c1">// Get the list of neighbours</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-97"></a>       <span class="n">Instances</span> <span class="n">neighbours</span> <span class="o">=</span> <span class="n">m_NNSearch</span><span class="o">.</span><span class="na">kNearestNeighbours</span><span class="o">(</span><span class="n">testInstance</span><span class="o">,</span> <span class="n">m_K</span><span class="o">);</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-98"></a>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-99"></a>       <span class="c1">// Calculate calculate class probability distribution or target value</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-100"></a>       <span class="kt">double</span><span class="o">[]</span> <span class="n">dist</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">double</span><span class="o">[</span><span class="n">testInstance</span><span class="o">.</span><span class="na">numClasses</span><span class="o">()];</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-101"></a>       <span class="k">for</span> <span class="o">(</span><span class="n">Instance</span> <span class="n">neighbour</span> <span class="o">:</span> <span class="n">neighbours</span><span class="o">)</span> <span class="o">{</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-102"></a>           <span class="k">if</span> <span class="o">(</span><span class="n">testInstance</span><span class="o">.</span><span class="na">classAttribute</span><span class="o">().</span><span class="na">isNominal</span><span class="o">())</span> <span class="o">{</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-103"></a>               <span class="n">dist</span><span class="o">[(</span><span class="kt">int</span><span class="o">)</span><span class="n">neighbour</span><span class="o">.</span><span class="na">classValue</span><span class="o">()]</span> <span class="o">+=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">neighbours</span><span class="o">.</span><span class="na">numInstances</span><span class="o">();</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-104"></a>           <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-105"></a>               <span class="n">dist</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">+=</span> <span class="n">neighbour</span><span class="o">.</span><span class="na">classValue</span><span class="o">()</span> <span class="o">/</span> <span class="n">neighbours</span><span class="o">.</span><span class="na">numInstances</span><span class="o">();</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-106"></a>           <span class="o">}</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-107"></a>       <span class="o">}</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-108"></a>       <span class="k">return</span> <span class="n">dist</span><span class="o">;</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-109"></a>   <span class="o">}</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-110"></a>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-111"></a>   <span class="cm">/**</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-112"></a><span class="cm">    * Returns a textual description of the classifier.</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-113"></a><span class="cm">    */</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-114"></a>   <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-115"></a>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-116"></a>       <span class="c1">// Not much to output here for KNN: no explicit model</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-117"></a>       <span class="k">return</span> <span class="s">"KNN with "</span> <span class="o">+</span> <span class="n">m_K</span> <span class="o">+</span> <span class="s">" neighbours"</span><span class="o">;</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-118"></a>   <span class="o">}</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-119"></a>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-120"></a>   <span class="cm">/**</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-121"></a><span class="cm">    * Main method, can be used to run classifier from command-line.</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-122"></a><span class="cm">    */</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-123"></a>   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-124"></a>       <span class="n">runClassifier</span><span class="o">(</span><span class="k">new</span> <span class="n">KNN</span><span class="o">(),</span> <span class="n">args</span><span class="o">);</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-125"></a>   <span class="o">}</span>
<a name="rest_code_d588aec12977499a8e18857c3955c2ab-126"></a><span class="o">}</span>
</pre>
<p>In this simple classifier, the biggest method is the <tt class="docutils literal">getCapabilities()</tt> method. This method is optional. It specifies what kind of data this classifier is able to deal with and is used in Weka’s GUIs to grey out a classifier if it is not applicable to a particular dataset. It is also used in the <tt class="docutils literal">buildClassifier(Instances)</tt> method in this example code: <tt class="docutils literal"><span class="pre">getCapabilities().testWithFail(trainingData)</span></tt> will use this method to check whether the classifier is actually applicable to the data provided as the training data. Note that implementing this method is really optional: <tt class="docutils literal">AbstractClassifier</tt> has a default implementation of <tt class="docutils literal">getCapabilities()</tt> that does not restrict the classifier in any way. Basically, <tt class="docutils literal">getCapabilities()</tt> only needs to be implemented if you want your classifier to be used by other users, to make it more user friendly.</p>
<p>The <tt class="docutils literal">main()</tt> method in the example class is used to run the classifier from the command-line. The <tt class="docutils literal">runClassifier(Classifier, <span class="pre">String[])</span></tt> method called in this <tt class="docutils literal">main()</tt> method will use Weka’s <tt class="docutils literal">Evaluation</tt> class to enable a cross-validation, etc., of the classifier on the data that is provided. It will automatically enable all the general command-line options available for evaluation of Weka classifiers and also make use of the specific command-line options that are provided in the code for the classifier via the <tt class="docutils literal">@OptionMetaData</tt> tag. Note that if you only want your classifier to be used in Weka’s GUIs, you do not need the <tt class="docutils literal">main()</tt> method and you do not need the <tt class="docutils literal">@OptionMetadata</tt> annotation either.</p>
<p>Below, I have included a minimalist version of the example class that has the absolute minimum amount of code necessary to use the classifier in Weka’s GUIs. It would be enough to run experiments with the K-nearest-neighbour method in Weka’s Experimenter GUI, etc. As you can see, it is pretty straightforward to implement a classifier in Weka, particularly if you only want to quickly run some experiments with a learning algorithm that you have dreamed up!</p>
<pre class="code Java"><a name="rest_code_143a9da851654435b114cc37dc4fdcb1-1"></a><span class="kn">package</span> <span class="nn">weka.classifiers.lazy</span><span class="o">;</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-2"></a>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-3"></a><span class="kn">import</span> <span class="nn">weka.core.Instance</span><span class="o">;</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-4"></a><span class="kn">import</span> <span class="nn">weka.core.Instances</span><span class="o">;</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-5"></a><span class="kn">import</span> <span class="nn">weka.classifiers.AbstractClassifier</span><span class="o">;</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-6"></a><span class="kn">import</span> <span class="nn">weka.core.neighboursearch.LinearNNSearch</span><span class="o">;</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-7"></a><span class="kn">import</span> <span class="nn">weka.core.neighboursearch.NearestNeighbourSearch</span><span class="o">;</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-8"></a>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-9"></a><span class="kd">public</span> <span class="kd">class</span> <span class="nc">KNNMinimal</span> <span class="kd">extends</span> <span class="n">AbstractClassifier</span> <span class="o">{</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-10"></a>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-11"></a>   <span class="kd">protected</span> <span class="kt">int</span> <span class="n">m_K</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-12"></a>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-13"></a>   <span class="kd">protected</span> <span class="n">NearestNeighbourSearch</span> <span class="n">m_NNSearch</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinearNNSearch</span><span class="o">();</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-14"></a>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-15"></a>   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setK</span><span class="o">(</span><span class="kt">int</span> <span class="n">k</span><span class="o">)</span> <span class="o">{</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-16"></a>       <span class="n">m_K</span> <span class="o">=</span> <span class="n">k</span><span class="o">;</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-17"></a>   <span class="o">}</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-18"></a>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-19"></a>   <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getK</span><span class="o">()</span> <span class="o">{</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-20"></a>       <span class="k">return</span> <span class="n">m_K</span><span class="o">;</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-21"></a>   <span class="o">}</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-22"></a>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-23"></a>   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">buildClassifier</span><span class="o">(</span><span class="n">Instances</span> <span class="n">trainingData</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-24"></a>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-25"></a>       <span class="n">trainingData</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Instances</span><span class="o">(</span><span class="n">trainingData</span><span class="o">);</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-26"></a>       <span class="n">trainingData</span><span class="o">.</span><span class="na">deleteWithMissingClass</span><span class="o">();</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-27"></a>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-28"></a>       <span class="n">m_NNSearch</span><span class="o">.</span><span class="na">setInstances</span><span class="o">(</span><span class="n">trainingData</span><span class="o">);</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-29"></a>   <span class="o">}</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-30"></a>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-31"></a>   <span class="kd">public</span> <span class="kt">double</span><span class="o">[]</span> <span class="nf">distributionForInstance</span><span class="o">(</span><span class="n">Instance</span> <span class="n">testInstance</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-32"></a>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-33"></a>       <span class="n">m_NNSearch</span><span class="o">.</span><span class="na">addInstanceInfo</span><span class="o">(</span><span class="n">testInstance</span><span class="o">);</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-34"></a>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-35"></a>       <span class="n">Instances</span> <span class="n">neighbours</span> <span class="o">=</span> <span class="n">m_NNSearch</span><span class="o">.</span><span class="na">kNearestNeighbours</span><span class="o">(</span><span class="n">testInstance</span><span class="o">,</span> <span class="n">m_K</span><span class="o">);</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-36"></a>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-37"></a>       <span class="kt">double</span><span class="o">[]</span> <span class="n">dist</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">double</span><span class="o">[</span><span class="n">testInstance</span><span class="o">.</span><span class="na">numClasses</span><span class="o">()];</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-38"></a>       <span class="k">for</span> <span class="o">(</span><span class="n">Instance</span> <span class="n">neighbour</span> <span class="o">:</span> <span class="n">neighbours</span><span class="o">)</span> <span class="o">{</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-39"></a>           <span class="k">if</span> <span class="o">(</span><span class="n">testInstance</span><span class="o">.</span><span class="na">classAttribute</span><span class="o">().</span><span class="na">isNominal</span><span class="o">())</span> <span class="o">{</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-40"></a>               <span class="n">dist</span><span class="o">[(</span><span class="kt">int</span><span class="o">)</span><span class="n">neighbour</span><span class="o">.</span><span class="na">classValue</span><span class="o">()]</span> <span class="o">+=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">neighbours</span><span class="o">.</span><span class="na">numInstances</span><span class="o">();</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-41"></a>           <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-42"></a>               <span class="n">dist</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">+=</span> <span class="n">neighbour</span><span class="o">.</span><span class="na">classValue</span><span class="o">()</span> <span class="o">/</span> <span class="n">neighbours</span><span class="o">.</span><span class="na">numInstances</span><span class="o">();</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-43"></a>           <span class="o">}</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-44"></a>       <span class="o">}</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-45"></a>       <span class="k">return</span> <span class="n">dist</span><span class="o">;</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-46"></a>   <span class="o">}</span>
<a name="rest_code_143a9da851654435b114cc37dc4fdcb1-47"></a><span class="o">}</span>
</pre>
<p>One more thing: if you want your class to be located in a new Java package that is not one of Weka’s standard packages for classifiers, you will need to make an appropriate version of the <tt class="docutils literal">GenericPropertiesCreate.props</tt> file for Weka. For example, the <tt class="docutils literal">RPlugin</tt> package for Weka defines a new <tt class="docutils literal">weka.classifiers.mlr</tt> package and has the following info in the <tt class="docutils literal">GenericPropertiesCreator.props</tt> file:</p>
<pre class="literal-block">
weka.classifiers.Classifier=\
weka.classifiers.mlr
</pre>
<p>That is it from me for today. Hope you are finding this useful.</p>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/github/" rel="tag">github</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../2018-09-04-383-and-393-released/" rel="prev" title="Weka 3.8.3 and 3.9.3 released">Previous post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="http-www-cs-waikato-ac-nz-ml-weka-blog",
            disqus_url="https://waikato.github.io/weka-blog/posts/2018-10-08-making-a-weka-classifier/",
        disqus_title="Making a Weka classifier",
        disqus_identifier="cache/posts/2018-10-08-making-a-weka-classifier.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="http-www-cs-waikato-ac-nz-ml-weka-blog";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2018         <a href="mailto:eibe@waikato.ac.nz">The WEKA Team</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
